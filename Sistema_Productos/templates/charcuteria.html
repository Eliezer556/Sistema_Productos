{% extends "index.html" %}
{% load static %}

{% block extra_styles %}
    <link rel="stylesheet" href="{% static 'producto.css' %}">
{% endblock %}

{% block content %}
    {% if productos_precio %}
    <article class="container-producto">
        <!-- Barra de búsqueda mejorada -->
        <div class="search-container p-3 position-relative">
            <span data-lucide="search" class="position-absolute search-icon"></span>
            <input id="busqueda-producto" class="form-control" type="text" placeholder="Buscar productos...">
        </div>
        
        <!-- Contenedor de productos con filtrado -->
        <div class="product-grid" id="product-grid">
            {% for item in productos_precio %}
                <div class="producto-tarjeta" data-name="{{ item.producto.name|lower }}" data-category="{{ item.producto.categoria|lower }}">
                    <!-- Etiqueta de estado integrada -->
                    {% if item.producto.status == 'agotado' %}
                        <div class="status-badge status-unavailable">
                            <span data-lucide="x-circle" class="status-icon"></span>
                            AGOTADO
                        </div>
                    {% else %}
                        <div class="status-badge status-available">
                            <span data-lucide="check-circle" class="status-icon"></span>
                            DISPONIBLE
                        </div>
                    {% endif %}
                    
                    <!-- Imagen del producto -->
                    <div class="product-img-container">
                        <img src="{{ item.producto.imagen.url }}" alt="{{ item.producto.name }}">
                    </div>
                    
                    <!-- Información del producto -->
                    <div class="product-info">
                        <div class="precio-producto">${{ item.precio_real|floatformat:2 }}</div>
                        <h3 class="nombre-producto">{{ item.producto.name|title }}</h3>
                        <p class="descripcion-producto">{{ item.producto.descripcion|truncatechars:100 }}</p>
                    </div>
                    
                    <!-- Botón de acción -->
                    {% if item.producto.status == 'disponible' %}
                        <button class="select-button" 
                                data-id="{{ item.producto.id }}" 
                                data-name="{{ item.producto.name }}" 
                                data-price="{{ item.precio_real }}">
                            <span data-lucide="shopping-cart" class="button-icon"></span>
                            Añadir al carrito
                        </button>
                    {% else %}
                        <button class="select-button" disabled>
                            <span data-lucide="clock" class="button-icon"></span>
                            No disponible
                        </button>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
    </article>
    {% else %}
        <div class="text-center py-5 empty-state">
            <span data-lucide="frown" width="48" height="48" class="text-muted mb-3"></span>
            <h4 class="text-muted">No hay productos disponibles</h4>
            <p class="text-muted">Pronto tendremos nuevos productos para ti</p>
        </div>
    {% endif %}

    <script src="{% static 'js/carrito.js' %}"></script>
    <script src="{% static 'js/filtrado_producto.js' %}"></script>
{% endblock %}